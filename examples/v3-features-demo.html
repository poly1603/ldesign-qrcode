<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QRCode v3.0 - æ–°åŠŸèƒ½æ¼”ç¤º</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }

    h1 {
      color: #333;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }

    .section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .section h2 {
      color: #667eea;
      margin-top: 0;
    }

    .demo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .demo-item {
      text-align: center;
    }

    .demo-item h3 {
      font-size: 14px;
      color: #666;
      margin: 10px 0 5px 0;
    }

    .qr-container {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      display: inline-block;
    }

    .stats {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      padding: 15px;
      margin-top: 15px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
    }

    .controls {
      margin: 15px 0;
    }

    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
      font-size: 14px;
    }

    button:hover {
      background: #5568d3;
    }

    .badge {
      display: inline-block;
      background: #10b981;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      margin-left: 8px;
    }
  </style>
</head>

<body>
  <h1>ğŸš€ QRCode v3.0 - æ–°åŠŸèƒ½æ¼”ç¤º</h1>

  <!-- WebGL æ¸²æŸ“ -->
  <div class="section">
    <h2>âš¡ WebGL æ¸²æŸ“ <span class="badge">GPUåŠ é€Ÿ</span></h2>
    <p>ä½¿ç”¨GPUåŠ é€Ÿæ¸²æŸ“å¤æ‚æ•ˆæœï¼Œæ€§èƒ½æå‡3-5å€</p>
    <div class="demo-grid">
      <div class="demo-item">
        <h3>Canvas æ¸²æŸ“</h3>
        <div id="canvas-demo"></div>
        <div id="canvas-time" class="stats"></div>
      </div>
      <div class="demo-item">
        <h3>WebGL æ¸²æŸ“</h3>
        <div id="webgl-demo"></div>
        <div id="webgl-time" class="stats"></div>
      </div>
    </div>
  </div>

  <!-- é«˜çº§æ»¤é•œ -->
  <div class="section">
    <h2>ğŸ¨ é«˜çº§æ»¤é•œç³»ç»Ÿ</h2>
    <p>15+ ç§å›¾åƒå¤„ç†æ»¤é•œ</p>
    <div class="demo-grid">
      <div class="demo-item">
        <h3>å¤å¤æ»¤é•œ</h3>
        <div id="filter-vintage"></div>
      </div>
      <div class="demo-item">
        <h3>ç´ ææ»¤é•œ</h3>
        <div id="filter-sketch"></div>
      </div>
      <div class="demo-item">
        <h3>åƒç´ åŒ–</h3>
        <div id="filter-pixelate"></div>
      </div>
      <div class="demo-item">
        <h3>æ»¤é•œé“¾</h3>
        <div id="filter-chain"></div>
      </div>
    </div>
  </div>

  <!-- 3Då˜æ¢ -->
  <div class="section">
    <h2>ğŸŒ 3D å˜æ¢ç³»ç»Ÿ</h2>
    <p>å®Œæ•´çš„3Dé€è§†ã€æ—‹è½¬å’Œå…‰ç…§æ”¯æŒ</p>
    <div class="demo-grid">
      <div class="demo-item">
        <h3>Xè½´æ—‹è½¬</h3>
        <div id="transform-rotateX"></div>
      </div>
      <div class="demo-item">
        <h3>Yè½´æ—‹è½¬</h3>
        <div id="transform-rotateY"></div>
      </div>
      <div class="demo-item">
        <h3>é€è§†æŠ•å½±</h3>
        <div id="transform-perspective"></div>
      </div>
      <div class="demo-item">
        <h3>å…‰ç…§æ•ˆæœ</h3>
        <div id="transform-lighting"></div>
      </div>
    </div>
  </div>

  <!-- å†…å­˜ä¼˜åŒ– -->
  <div class="section">
    <h2>ğŸ’¾ å†…å­˜ä¼˜åŒ–</h2>
    <p>å¯¹è±¡æ± å’ŒBitArrayå¤§å¹…å‡å°‘å†…å­˜å ç”¨</p>
    <div class="controls">
      <button onclick="testObjectPool()">æµ‹è¯•å¯¹è±¡æ± </button>
      <button onclick="testBitArray()">æµ‹è¯• BitArray</button>
      <button onclick="testMemoryComparison()">å†…å­˜å¯¹æ¯”</button>
    </div>
    <div id="memory-stats" class="stats"></div>
  </div>

  <!-- ç¼“å­˜ç³»ç»Ÿ -->
  <div class="section">
    <h2>âš¡ åˆ†å±‚ç¼“å­˜ç³»ç»Ÿ</h2>
    <p>L1å†…å­˜ç¼“å­˜ + L2æŒä¹…åŒ–ç¼“å­˜</p>
    <div class="controls">
      <button onclick="testCache()">æµ‹è¯•ç¼“å­˜æ€§èƒ½</button>
      <button onclick="showCacheStats()">æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡</button>
      <button onclick="clearAllCache()">æ¸…é™¤ç¼“å­˜</button>
    </div>
    <div id="cache-stats" class="stats"></div>
  </div>

  <!-- æ€§èƒ½åŸºå‡† -->
  <div class="section">
    <h2>ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•</h2>
    <div class="controls">
      <button onclick="runBenchmark()">è¿è¡Œå®Œæ•´åŸºå‡†æµ‹è¯•</button>
    </div>
    <div id="benchmark-results" class="stats"></div>
  </div>

  <script type="module">
    import {
      createQRCode,
      isWebGLSupported,
      getAllPoolStats,
      cleanupAllPools,
      BitArray,
      BitMatrix,
      calculateMemorySavings,
      getCacheStats,
      clearCache,
      preloadCache,
    } from '../dist/index.esm.js';

    // WebGL vs Canvas å¯¹æ¯”
    function renderComparison() {
      const config = {
        content: 'https://example.com',
        style: {
          size: 250,
          gradient: {
            type: 'linear',
            colors: ['#667eea', '#764ba2', '#f093fb'],
            direction: 45,
          },
          dotStyle: 'rounded',
        },
      };

      // Canvas
      const canvasStart = performance.now();
      createQRCode({
        ...config,
        container: document.getElementById('canvas-demo'),
        renderType: 'canvas',
      });
      const canvasTime = performance.now() - canvasStart;
      document.getElementById('canvas-time').textContent =
        `æ¸²æŸ“æ—¶é—´: ${canvasTime.toFixed(2)}ms`;

      // WebGL
      if (isWebGLSupported()) {
        const webglStart = performance.now();
        createQRCode({
          ...config,
          container: document.getElementById('webgl-demo'),
          renderType: 'webgl',
        });
        const webglTime = performance.now() - webglStart;
        document.getElementById('webgl-time').textContent =
          `æ¸²æŸ“æ—¶é—´: ${webglTime.toFixed(2)}ms\nåŠ é€Ÿ: ${(canvasTime / webglTime).toFixed(2)}x`;
      } else {
        document.getElementById('webgl-demo').innerHTML =
          '<p style="color: #999;">WebGLä¸æ”¯æŒ</p>';
      }
    }

    // æ»¤é•œæ¼”ç¤º
    function renderFilters() {
      const baseConfig = {
        content: 'https://example.com/filter-demo',
        style: { size: 200 },
      };

      // å¤å¤
      createQRCode({
        ...baseConfig,
        container: document.getElementById('filter-vintage'),
        style: {
          ...baseConfig.style,
          filter: { type: 'vintage', intensity: 0.8 },
        },
      });

      // ç´ æ
      createQRCode({
        ...baseConfig,
        container: document.getElementById('filter-sketch'),
        style: {
          ...baseConfig.style,
          filter: { type: 'sketch', threshold: 120 },
        },
      });

      // åƒç´ åŒ–
      createQRCode({
        ...baseConfig,
        container: document.getElementById('filter-pixelate'),
        style: {
          ...baseConfig.style,
          filter: { type: 'pixelate', radius: 8 },
        },
      });

      // æ»¤é•œé“¾
      createQRCode({
        ...baseConfig,
        container: document.getElementById('filter-chain'),
        style: {
          ...baseConfig.style,
          filter: [
            { type: 'sepia', intensity: 0.5 },
            { type: 'contrast', intensity: 0.2 },
            { type: 'blur', radius: 1 },
          ],
        },
      });
    }

    // 3Då˜æ¢æ¼”ç¤º
    function render3DTransforms() {
      const baseConfig = {
        content: 'https://example.com/3d',
        style: { size: 200 },
      };

      // Xè½´æ—‹è½¬
      createQRCode({
        ...baseConfig,
        container: document.getElementById('transform-rotateX'),
        style: {
          ...baseConfig.style,
          transform3D: {
            rotateX: 30,
            perspective: 800,
          },
        },
      });

      // Yè½´æ—‹è½¬
      createQRCode({
        ...baseConfig,
        container: document.getElementById('transform-rotateY'),
        style: {
          ...baseConfig.style,
          transform3D: {
            rotateY: 30,
            perspective: 800,
          },
        },
      });

      // é€è§†
      createQRCode({
        ...baseConfig,
        container: document.getElementById('transform-perspective'),
        style: {
          ...baseConfig.style,
          transform3D: {
            rotateX: 20,
            rotateY: 20,
            rotateZ: 5,
            perspective: 600,
          },
        },
      });

      // å…‰ç…§
      createQRCode({
        ...baseConfig,
        container: document.getElementById('transform-lighting'),
        style: {
          ...baseConfig.style,
          transform3D: {
            rotateX: 30,
            rotateY: 20,
            perspective: 800,
            lightSource: { x: 1, y: 1, z: 1 },
            ambientLight: 0.4,
            diffuseLight: 0.8,
          },
        },
      });
    }

    // å…¨å±€å‡½æ•°ä¾›æŒ‰é’®è°ƒç”¨
    window.testObjectPool = function () {
      const stats = getAllPoolStats();
      document.getElementById('memory-stats').textContent =
        JSON.stringify(stats, null, 2);
    };

    window.testBitArray = function () {
      const array = new BitArray(1000);
      for (let i = 0; i < 100; i++) {
        array.set(i * 10);
      }

      const matrix = new BitMatrix(21, 21);
      matrix.set(10, 10);

      document.getElementById('memory-stats').textContent =
        `BitArray: ${array.count()} bits è®¾ç½®\n` +
        `ByteSize: ${array.getByteSize()} bytes\n` +
        `BitMatrix: ${matrix.getByteSize()} bytes`;
    };

    window.testMemoryComparison = function () {
      const savings = calculateMemorySavings(177);
      document.getElementById('memory-stats').textContent =
        `Version 40 QRç  (177x177):\n` +
        `å¸ƒå°”æ•°ç»„: ${savings.booleanArray} bytes\n` +
        `ä½æ•°ç»„: ${savings.bitArray} bytes\n` +
        `èŠ‚çœ: ${savings.savings} bytes (${savings.savingsPercent.toFixed(1)}%)`;
    };

    window.testCache = async function () {
      const iterations = 10;
      const config = {
        content: 'cache-test',
        style: { size: 200 },
      };

      const times = [];
      for (let i = 0; i < iterations; i++) {
        const start = performance.now();
        const div = document.createElement('div');
        createQRCode({ ...config, container: div });
        times.push(performance.now() - start);
      }

      const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
      const stats = getCacheStats();

      document.getElementById('cache-stats').textContent =
        `å¹³å‡æ¸²æŸ“æ—¶é—´: ${avgTime.toFixed(2)}ms\n` +
        `ç¼“å­˜ç»Ÿè®¡:\n${JSON.stringify(stats, null, 2)}`;
    };

    window.showCacheStats = function () {
      const stats = getCacheStats();
      document.getElementById('cache-stats').textContent =
        JSON.stringify(stats, null, 2);
    };

    window.clearAllCache = async function () {
      await clearCache();
      document.getElementById('cache-stats').textContent = 'ç¼“å­˜å·²æ¸…é™¤';
    };

    window.runBenchmark = function () {
      const results = [];

      // ç®€å•QRç 
      const simple = [];
      for (let i = 0; i < 50; i++) {
        const start = performance.now();
        const div = document.createElement('div');
        createQRCode({
          content: `test-${i}`,
          container: div,
          style: { size: 200 },
        });
        simple.push(performance.now() - start);
      }

      results.push(`ç®€å•QRç  (50æ¬¡):`);
      results.push(`  å¹³å‡: ${(simple.reduce((a, b) => a + b) / simple.length).toFixed(2)}ms`);
      results.push(`  æœ€å°: ${Math.min(...simple).toFixed(2)}ms`);
      results.push(`  æœ€å¤§: ${Math.max(...simple).toFixed(2)}ms`);
      results.push('');

      // å¤æ‚æ¸å˜
      const complex = [];
      for (let i = 0; i < 20; i++) {
        const start = performance.now();
        const div = document.createElement('div');
        createQRCode({
          content: `complex-${i}`,
          container: div,
          style: {
            size: 300,
            gradient: {
              type: 'radial',
              colors: ['#667eea', '#764ba2', '#f093fb'],
            },
            dotStyle: 'dots',
          },
        });
        complex.push(performance.now() - start);
      }

      results.push(`å¤æ‚æ¸å˜ (20æ¬¡):`);
      results.push(`  å¹³å‡: ${(complex.reduce((a, b) => a + b) / complex.length).toFixed(2)}ms`);
      results.push(`  æœ€å°: ${Math.min(...complex).toFixed(2)}ms`);
      results.push(`  æœ€å¤§: ${Math.max(...complex).toFixed(2)}ms`);

      document.getElementById('benchmark-results').textContent = results.join('\n');
    };

    // åˆå§‹åŒ–æ¸²æŸ“
    renderComparison();
    renderFilters();
    render3DTransforms();
  </script>
</body>

</html>
